---
title: "Automated FPS Map Balance Validation System"
description: "QGIS 수동 분석을 Python으로 자동화하여 랜덤 생성된 맵의 팀 간 시야 균형을 정량적으로 검증하는 시스템"
pubDate: 2025-10-04
category: "Side Projects"
tags: ["Python", "Spatial Analysis", "Game Development", "Automation", "Line-of-Sight"]
---

**GitHub Repository**: https://github.com/vanillapapaya/automated-fps-map-balance-validation-system

## 프로젝트 배경

이전 회사에서 FPS 맵 분석을 진행할 때 QGIS를 사용하여 팀 간 시야 노출 균형을 수동으로 계산했습니다. 이 과정은 효과적이었지만 시간이 오래 걸렸고, 맵마다 반복적으로 동일한 작업을 수행해야 했습니다.

이 프로젝트는 QGIS에서 수동으로 진행하던 시야 분석을 Python으로 완전히 자동화하는 것을 목표로 시작했습니다. Perlin noise로 랜덤하게 생성된 지형에 대해 팀 간 시야 노출 균형을 자동으로 측정하고, 공정성 기준에 맞는 맵만 선별하는 검증 시스템을 구축했습니다.

개발 과정에서는 Claude Code를 활용했습니다. 최근 게임 업계에서도 AI 도구 활용 능력이 중요해지고 있고, 특히 R&D 영역에서 빠른 프로토타이핑이 필요한 상황이 많습니다. 이 프로젝트를 통해 AI 코딩 도구가 실제 분석 작업에서 어떻게 활용될 수 있는지 직접 실험해보고 싶었습니다. 명세서를 작성하여 알고리즘을 설명했고, Claude가 추천하는 프로젝트 구성을  채택했습니다. 생성된 Jupyter Notebook 파일을 직접 실행하며 잘못된 부분을 수정하고, 최종적으로 이를 Python 스크립트로 변환하여 실험하는 방식으로 진행했습니다.

## 현재 구현과 한계

현재 시스템은 Perlin noise로 생성된 랜덤 지형을 받아서 팀 존을 할당하고, 각 팀 영역에서 샘플 포인트를 추출한 뒤 모든 가능한 조합에 대해 Line-of-Sight 계산을 수행합니다. 64x64 맵의 경우 약 200만 회의 시야선 체크가 필요하며 2-5분이 소요됩니다.

이 방식의 핵심 한계는 생성과 검증이 분리되어 있다는 점입니다. 맵을 먼저 랜덤하게 만들고, 검증 후 기준에 맞지 않으면 폐기하는 구조입니다. 균형잡힌 맵을 얻기 위해 수십 개를 생성하고 버려야 할 수 있습니다.

## 향후 개선 방향

가장 먼저 해결해야 할 문제는 성능입니다. 64x64 맵을 검증하는데 2-5분이 걸리면 실시간 피드백은 불가능합니다. NumPy 벡터화나 멀티프로세싱으로 어느 정도 개선할 수 있고, GPU 가속을 고려한다면 수 초 내 처리도 가능합니다. 하지만 이것만으로는 부족합니다.

현재 시스템의 근본적 한계는 맵을 랜덤하게 만들고 검증한 뒤 기준에 맞지 않으면 버린다는 점입니다. 균형잡힌 맵 하나를 얻기 위해 수십 개를 생성하고 폐기하는 것은 비효율적입니다. 진짜 해결책은 애초에 불균형한 맵이 만들어지지 않도록 생성 단계부터 제약을 가하는 것입니다.

예를 들어 Perlin noise 한 번 호출하는 대신, 여러 주파수의 노이즈를 레이어링하여 산맥과 계곡을 형성하고 침식 시뮬레이션을 통해 현실적인 지형을 만들 수 있습니다. 여기에 팀 존 경계에서의 고도 차이를 제한하거나, 맵 중앙에 양 팀이 경쟁할 만한 고지대를 배치하되 양쪽에서의 접근 난이도를 비슷하게 만드는 식으로 규칙을 추가할 수 있습니다. 현재 구축한 검증 시스템은 이러한 절차적 생성 알고리즘이 제대로 작동하는지 확인하는 피드백 루프로 활용될 것입니다.

물론 이것도 완벽한 해결책은 아닙니다. 제약 조건을 너무 많이 추가하면 오히려 평범하고 지루한 맵만 나올 위험이 있습니다. 균형과 다양성 사이의 적절한 지점을 찾는 것이 핵심입니다. 하지만 지금처럼 아무 규칙 없이 랜덤하게 만들고 버리는 것보다는 훨씬 나은 출발점입니다.

## 실무 활용 가능성

검증을 통과한 맵의 heightmap은 PNG 또는 RAW 형식으로 내보내 Unreal Engine의 Landscape 시스템에 직접 가져올 수 있습니다. Python에서 균형이 검증된 지형을 게임 엔진에서 플레이 가능한 레벨로 빠르게 변환할 수 있다는 뜻입니다.

이 워크플로우는 레벨 디자이너에게 유용할 수 있습니다. 여러 후보 맵을 자동으로 생성하고 검증한 뒤, 그 중 가장 흥미로운 것을 선택하여 Unreal Engine에서 세부 디테일을 추가하는 방식입니다. 순수 수작업보다 빠르고, 무작위 생성보다는 품질 통제가 가능합니다.

## 생성 결과물

![원본 지형](/images/step1_raw_heightmap.png)

Perlin noise로 생성된 원본 heightmap입니다. 밝을수록 높은 고도를 나타냅니다.

![팀 존 할당](/images/step2_team_zones.png)

맵을 Team A와 Team B 영역으로 구분한 결과입니다. 파란색과 빨간색으로 각 팀의 구역이 표시됩니다.

![샘플 포인트 배치](/images/step3_sample_points.png)

각 팀 존에서 선택된 관찰자와 타겟 포인트의 위치입니다. 이 포인트들을 기준으로 시야 분석을 수행합니다.

![Line-of-Sight 계산](/images/step4_line_of_sight.png)

특정 관찰자에서 타겟까지의 시야선을 그리고 지형에 의한 차단 여부를 확인한 결과입니다.

![노출도 분석](/images/step5_exposure_calculation.png)

각 픽셀의 노출도를 색상으로 표현한 히트맵입니다. 붉은색은 높은 노출(위험), 파란색은 낮은 노출(안전)을 의미합니다.
